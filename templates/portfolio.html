{% extends "base.html" %}
{% block title %}Portfolio{% endblock %}
{% block body %}
{% include "topbar.html" %}
<div class="layout">
  {% include "sidebar.html" %}
  <div class="main">
    <div class="page-header">
      <div><div class="page-title">My Portfolio</div><div class="page-sub">Your fractional token holdings across all assets</div></div>
      <div class="btn-row"><button class="btn btn-secondary">⬇ Export CSV</button><a href="/transfer" class="btn btn-primary">◑ Buy More</a></div>
    </div>
    <div class="stats-row stats-3">
      <div class="stat-card stat-blue"><div class="stat-icon">◈</div><div class="stat-label">Portfolio Value</div><div class="stat-value">${{ "{:,}".format(total_value) }}</div><div class="stat-change">↑ +8.3% this month</div></div>
      <div class="stat-card stat-green"><div class="stat-icon">⬡</div><div class="stat-label">Total Tokens Held</div><div class="stat-value">{{ "{:,}".format(total_tokens) }}</div><div class="stat-change">Across {{ portfolio|length }} assets</div></div>
      <div class="stat-card stat-amber"><div class="stat-icon">◑</div><div class="stat-label">Unrealised Gain</div><div class="stat-value">+${{ "{:,}".format(total_gain) }}</div><div class="stat-change">↑ +9.1% avg</div></div>
    </div>
    <div class="card">
      <div class="card-header"><div class="card-title">Token Holdings</div><span class="tag tag-green">{{ portfolio|length }} Assets</span></div>
      <table class="tx-table">
        <thead><tr><th>Asset</th><th>Symbol</th><th>Tokens</th><th>Avg Cost</th><th>Current</th><th>Value</th><th>P&L</th></tr></thead>
        <tbody>
          {% for p in portfolio %}
          <tr>
            <td><div style="display:flex;align-items:center;gap:10px;"><span style="font-size:20px;">{{ p.emoji }}</span><div><div style="font-weight:600;">{{ p.name }}</div><div style="font-size:11px;color:var(--muted);">{{ p.type }}</div></div></div></td>
            <td><span style="font-family:'DM Mono',monospace;background:{{ p.sym_color }}22;padding:3px 8px;border-radius:4px;font-size:12px;color:{{ p.sym_color }};">{{ p.symbol }}</span></td>
            <td style="font-weight:700;">{{ "{:,}".format(p.tokens) }}</td>
            <td style="color:var(--muted);">${{ p.avg_cost }}</td>
            <td style="font-weight:700;">${{ p.current }}</td>
            <td style="font-family:'Syne',sans-serif;font-weight:700;">{{ p.value }}</td>
            <td style="color:{{ p.pl_color }};font-weight:600;">{{ p.pl }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>
{% endblock %}
